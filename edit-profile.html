<!DOCTYPE html>
<html class="dark" lang="fr">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Modifier Profile - ESSOR ACTIVE</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { "primary": "#49e619", "primary-hover": "#3cd010", "background-dark": "#0d140b", "surface-dark": "#1a2617" },
                    fontFamily: { "display": ["Manrope", "sans-serif"] },
                    borderRadius: { "DEFAULT": "1rem", "lg": "1.5rem", "2xl": "2.5rem" }
                }
            }
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        body {
            background-color: #0d140b;
            color: white;
        }

        input,
        select {
            -webkit-appearance: none;
        }
    </style>
</head>

<body class="font-display flex flex-col items-center justify-start min-h-screen p-6">
    <div class="w-full max-w-[420px] space-y-8 pb-12">
        <!-- Header -->
        <header class="flex items-center justify-between">
            <button onclick="window.history.back()" class="p-2 -ml-2 rounded-full hover:bg-white/10 transition-colors">
                <span class="material-symbols-outlined text-3xl">arrow_back</span>
            </button>
            <h1 class="text-xl font-bold tracking-tight">Modifier Profil</h1>
            <div class="w-10"></div>
        </header>

        <form id="edit-form" class="space-y-8">

            <!-- SECTION : IDENTITÉ -->
            <div class="space-y-4">
                <p class="text-[10px] font-black text-gray-500 uppercase tracking-[0.2em] pl-1">Identité</p>
                <div class="space-y-5 bg-white/5 p-6 rounded-3xl border border-white/[0.03]">
                    <div class="space-y-2">
                        <label class="text-[11px] font-bold text-gray-400 pl-1">Nom Complet</label>
                        <input type="text" id="name" required
                            class="w-full bg-black/40 border-white/5 rounded-2xl px-5 py-4 text-white focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all outline-none">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[11px] font-bold text-gray-400 pl-1">Email</label>
                        <input type="email" id="email" required
                            class="w-full bg-black/40 border-white/5 rounded-2xl px-5 py-4 text-white focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all outline-none">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-[11px] font-bold text-gray-400 pl-1">Âge</label>
                            <input type="number" id="age" required
                                class="w-full bg-black/40 border-white/5 rounded-2xl px-5 py-4 text-white focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all outline-none">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[11px] font-bold text-gray-400 pl-1">Sexe</label>
                            <select id="gender"
                                class="w-full bg-black/40 border-white/5 rounded-2xl px-5 py-4 text-white focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all outline-none">
                                <option value="Homme">Homme</option>
                                <option value="Femme">Femme</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION : PHYSIQUE -->
            <div class="space-y-4">
                <p class="text-[10px] font-black text-gray-500 uppercase tracking-[0.2em] pl-1">Physique</p>
                <div class="space-y-5 bg-white/5 p-6 rounded-3xl border border-white/[0.03]">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-[11px] font-bold text-gray-400 pl-1">Poids</label>
                            <div class="relative">
                                <input type="number" id="weight" step="0.1" required
                                    class="w-full bg-black/40 border-white/5 rounded-2xl px-5 py-4 text-white focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all outline-none pr-16">
                                <div class="absolute right-3 top-1/2 -translate-y-1/2 flex bg-white/5 rounded-xl p-1">
                                    <button type="button" onclick="setUnit('weight', 'kg')" id="btn-kg"
                                        class="px-2 py-1 text-[10px] font-black rounded-lg transition-colors">KG</button>
                                    <button type="button" onclick="setUnit('weight', 'lb')" id="btn-lb"
                                        class="px-2 py-1 text-[10px] font-black rounded-lg transition-colors">LB</button>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[11px] font-bold text-gray-400 pl-1">Taille</label>
                            <div class="relative">
                                <input type="number" id="height" required
                                    class="w-full bg-black/40 border-white/5 rounded-2xl px-5 py-4 text-white focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all outline-none pr-16">
                                <div class="absolute right-3 top-1/2 -translate-y-1/2 flex bg-white/5 rounded-xl p-1">
                                    <button type="button" onclick="setUnit('height', 'cm')" id="btn-cm"
                                        class="px-2 py-1 text-[10px] font-black rounded-lg transition-colors">CM</button>
                                    <button type="button" onclick="setUnit('height', 'in')" id="btn-in"
                                        class="px-2 py-1 text-[10px] font-black rounded-lg transition-colors">IN</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION : PROGRAMME -->
            <div class="space-y-4">
                <p class="text-[10px] font-black text-gray-500 uppercase tracking-[0.2em] pl-1">Objectifs</p>
                <div class="space-y-5 bg-white/5 p-6 rounded-3xl border border-white/[0.03]">
                    <div class="space-y-2">
                        <label class="text-[11px] font-bold text-gray-400 pl-1">Objectif Principal</label>
                        <select id="goal"
                            class="w-full bg-black/40 border-white/5 rounded-2xl px-5 py-4 text-white focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all outline-none">
                            <option value="Perte de poids">Perte de poids</option>
                            <option value="Prise de muscle">Prise de muscle</option>
                            <option value="Remise en forme">Remise en forme</option>
                            <option value="Performance">Performance</option>
                            <option value="Soulager des douleurs">Soulager des douleurs</option>
                        </select>
                    </div>
                </div>
            </div>

            <button type="submit"
                class="w-full bg-primary hover:bg-primary-hover text-black text-lg font-black py-5 rounded-full shadow-[0_10px_30px_rgba(73,230,25,0.3)] transition-all active:scale-[0.98]">
                SAUVEGARDER LES CHANGEMENTS
            </button>

        </form>
    </div>

    <!-- UI Feedback Toast -->
    <div id="toast"
        class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-primary text-black px-6 py-3 rounded-full font-bold text-sm shadow-2xl opacity-0 pointer-events-none transition-all translate-y-4 z-50">
        Profil mis à jour !
    </div>

    <script>
        let currentUnits = { weight: 'kg', height: 'cm' };

        function setUnit(type, unit) {
            currentUnits[type] = unit;
            updateUnitButtons();
        }

        function updateUnitButtons() {
            ['kg', 'lb', 'cm', 'in'].forEach(u => {
                const btn = document.getElementById(`btn-${u}`);
                if (btn) {
                    if (currentUnits.weight === u || currentUnits.height === u) {
                        btn.classList.add('bg-primary', 'text-black');
                        btn.classList.remove('text-gray-500');
                    } else {
                        btn.classList.remove('bg-primary', 'text-black');
                        btn.classList.add('text-gray-500');
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const clientData = JSON.parse(localStorage.getItem('clientUser') || '{}');
            const responses = JSON.parse(localStorage.getItem('responses') || '{}');

            // Prefill
            // Prefill
            document.getElementById('name').value = clientData.name || '';
            document.getElementById('email').value = clientData.email || '';
            document.getElementById('age').value = clientData.age || '';
            document.getElementById('age').value = clientData.age || '';
            document.getElementById('gender').value = clientData.gender || 'Homme';
            document.getElementById('weight').value = clientData.weight || '';
            document.getElementById('height').value = clientData.height || '';
            document.getElementById('goal').value = responses[5] || 'Remise en forme';

            if (clientData.weightUnit) currentUnits.weight = clientData.weightUnit;
            if (clientData.heightUnit) currentUnits.height = clientData.heightUnit;
            updateUnitButtons();

            document.getElementById('edit-form').addEventListener('submit', async (e) => {
                e.preventDefault();

                // Update local data
                const updatedClient = {
                    ...clientData,
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    age: document.getElementById('age').value,
                    gender: document.getElementById('gender').value,
                    weight: document.getElementById('weight').value,
                    height: document.getElementById('height').value,
                    weightUnit: currentUnits.weight,
                    heightUnit: currentUnits.height
                };

                const updatedResponses = { ...responses };
                updatedResponses[5] = document.getElementById('goal').value;

                localStorage.setItem('clientUser', JSON.stringify(updatedClient));
                localStorage.setItem('responses', JSON.stringify(updatedResponses));

                // SYNC WITH SERVER
                try {
                    const res = await fetch('/api/client/update', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(updatedClient)
                    });
                } catch (err) { console.error('Sync failed', err); }

                showToast();
                setTimeout(() => window.location.href = 'profile.html', 1500);
            });
        });

        function showToast() {
            const t = document.getElementById('toast');
            t.classList.remove('opacity-0', 'translate-y-4');
            t.classList.add('opacity-100', 'translate-y-0');
        }
    </script>
</body>

</html>